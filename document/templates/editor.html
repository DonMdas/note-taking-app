<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MyNotes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
    :root {
        --primary-color: #5D69BE;
        --secondary-color: #56CCF2;
        --accent-color: #FF6B6B;
        --text-color: #2D3748;
        --light-color: #F8FAFC;
        --sidebar-width: 280px;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #f5f7fa;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    /* Navbar styles */
    .navbar {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        background: #fff;
    }
    
    .navbar-brand a.navbar-item {
        font-weight: 700;
        font-size: 1.4rem;
        color: var(--primary-color);
    }
    
    .navbar-item .button {
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .navbar-item .button.is-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border: none;
    }
    
    .navbar-item .button.is-danger {
        background-color: var(--accent-color);
        border: none;
    }
    
    .navbar-item .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Section and menu styles */
    .section {
        flex: 1;
        padding: 2rem 1.5rem;
    }
    
    .menu {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        padding: 1.5rem;
        height: calc(100vh - 180px);
        overflow-y: auto;
    }
    
    .menu-label {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
        margin-bottom: 1rem;
    }
    
    .menu-list a {
        border-radius: 8px;
        margin-bottom: 0.5rem;
        padding: 0.7rem 1rem;
        transition: all 0.2s ease;
        color: var(--text-color);
    }
    
    .menu-list a:hover {
        background-color: rgba(93, 105, 190, 0.1);
        color: var(--primary-color);
    }
    
    .menu-list a.is-active {
        background-color: var(--primary-color);
        color: white;
    }
    
    /* Box and form container */
    .box {
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        padding: 2rem;
        height: calc(100vh - 180px);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    
    form {
        display: flex;
        flex-direction: column;
        width: 100%;
    }
    
    /* Fields and inputs */
    .field {
        margin-bottom: 1.5rem;
    }
    
    .field .label {
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .input, .textarea {
        border-radius: 8px;
        border-color: #e2e8f0;
        box-shadow: none;
        transition: all 0.3s ease;
        width: 100%;
    }
    
    .input:focus, .textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(93, 105, 190, 0.2);
    }
    
    /* Content textarea */
    #content-textarea {
        height: 250px;
        resize: none;
        overflow-y: auto;
        background-color: white;
        margin-bottom: 0;
    }
    
    /* Summary section */
    .summary-section {
        border-top: 2px solid #e2e8f0;
        padding-top: 1.8rem;
        margin-top: 1.8rem;
        margin-bottom: 1.8rem;
    }
    
    #summary-textarea {
        height: 220px; /* Increased from 150px to 220px */
        resize: none;
        overflow-y: auto;
        background-color: rgba(93, 105, 190, 0.05);
        margin-bottom: 0;
        border-width: 2px; /* Slightly thicker border for emphasis */
    }
    
    /* Enhance the summary section label */
    .summary-section .label {
        font-size: 1.1rem;
        color: var(--primary-color);
        margin-bottom: 0.8rem;
    }
    
    /* Buttons */
    .button.is-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .button.is-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(93, 105, 190, 0.4);
    }
    
    .button.is-info {
        background: linear-gradient(135deg, #38b2ac, #4299e1);
        border: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .button.is-info:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
    }
    
    .button.is-danger {
        background-color: var(--accent-color);
        border: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .is-danger.is-light {
        background-color: rgba(255, 107, 107, 0.1);
        color: var(--accent-color);
    }
    
    .is-danger.is-light:hover {
        background-color: rgba(255, 107, 107, 0.2);
        transform: translateY(-2px);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: #c5cae9;
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-color);
    }
    
    /* Responsive adjustments */
    @media screen and (max-width: 768px) {
        .section {
            padding: 1rem;
        }
        
        .box, .menu {
            height: auto;
            margin-bottom: 1.5rem;
        }
        
        #content-textarea, #summary-textarea {
            height: 200px;
        }
    }
</style>

<body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a href="{% url 'dashboard' %}" class="navbar-item">
                <i class="fas fa-book-open mr-2"></i> MyNotes
            </a>
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        <div id="navbarBasicExample" class="navbar-menu">
            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="buttons">
                        <a href="{% url 'editor' %}?docid=0" class="button is-primary">
                            <i class="fas fa-plus mr-2"></i> New Note
                        </a>
                        <a href="{% url 'logout' %}" class="button is-danger">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <section class="section">
        <div class="columns">
            <div class="column is-3">
                <aside class="menu">
                    <p class="menu-label">
                        <i class="fas fa-list-ul mr-2"></i> Your Notes
                    </p>
                    <ul class="menu-list">
                        {% for doc in notes %}
                            <li>
                                <a href="{% url 'editor' %}?docid={{ doc.id }}" {% if doc.id == docid %} class="is-active" {% endif %}>
                                    {{ doc.title }}
                                </a>
                            </li>
                        {% endfor %}
                        {% if not notes %}
                            <li><p class="has-text-grey py-2 px-4">No notes yet. Create your first note!</p></li>
                        {% endif %}
                    </ul>
                </aside>
            </div>

            <div class="column is-9">
                <div class="box">
                    <form method="post" action="{% url 'editor' %}" class="h-100 d-flex flex-column">
                        {% csrf_token %}
                        <input type="hidden" name="docid" value="{{ docid }}">
                        <input type="hidden" name="summary" id="summary-input" value="{% if note.summary %}{{ note.summary }}{% endif %}">
                        <div class="field">
                            <label class="label"><i class="fas fa-heading mr-2"></i> Title</label>
                            <div class="control">
                                <input type="text" class="input" name="title" placeholder="Enter note title..." {% if note %} value="{{ note.title }}"{% endif %} required>
                            </div>
                        </div>
                        <div class="field content-field">
                            <label class="label"><i class="fas fa-align-left mr-2"></i> Content</label>
                            <div class="control">
                                <textarea class="textarea" id="content-textarea" name="content" placeholder="Write your thoughts here...">{% if note %}{{ note.content }}{% endif %}</textarea>
                            </div>
                        </div>
                        <div class="summary-section" id="summary-section" {% if not note.summary %}style="display: none;"{% endif %}>
                            <label class="label"><i class="fas fa-list-alt mr-2"></i> Key Points</label>
                            <div class="control">
                                <textarea class="textarea" id="summary-textarea" name="summary" placeholder="Key points from your note will appear here...">{% if note.summary %}{{ note.summary }}{% endif %}</textarea>
                            </div>
                        </div>
                        <div class="field is-grouped mt-4">
                            <div class="control">
                                <button type="submit" class="button is-primary">
                                    <i class="fas fa-save mr-2"></i> Save Note
                                </button>
                            </div>
                            <div class="control">
                                <button type="button" id="summarize-btn" class="button is-info">
                                    <i class="fas fa-magic mr-2"></i> Summarize
                                </button>
                            </div>
                            {% if note %}
                                <div class="control">
                                    <a href="{% url 'delete_note' note.id %}" class="button is-danger is-light" onclick="return confirm('Are you sure you want to delete this note?')">
                                        <i class="fas fa-trash mr-2"></i> Delete
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elements
            const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
            const contentTextarea = document.getElementById('content-textarea');
            const summaryTextarea = document.getElementById('summary-textarea');
            const summarizeBtn = document.getElementById('summarize-btn');
            const summaryInput = document.getElementById('summary-input');
            const summarySection = document.getElementById('summary-section');
            
            // Navbar burger toggle
            if ($navbarBurgers.length > 0) {
                $navbarBurgers.forEach(el => {
                    el.addEventListener('click', () => {
                        const target = el.dataset.target;
                        const $target = document.getElementById(target);
                        el.classList.toggle('is-active');
                        $target.classList.toggle('is-active');
                    });
                });
            }
            
            // Keep summary input in sync with textarea
            if (summaryTextarea) {
                summaryTextarea.addEventListener('input', function() {
                    summaryInput.value = this.value;
                });
            }
            
            // Summarize button functionality
            if (summarizeBtn) {
                summarizeBtn.addEventListener('click', function() {
                    const content = contentTextarea.value.trim();
                    
                    if (!content) {
                        alert('Please add some content to summarize.');
                        return;
                    }
                    
                    // Show loading state
                    summarizeBtn.classList.add('is-loading');
                    summarizeBtn.disabled = true;
                    
                    // Create form data for the request
                    const formData = new FormData();
                    formData.append('content', content);
                    formData.append('docid', '{{ docid }}');
                    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                    
                    // Send request to the backend
                    fetch('{% url "summarize_note" %}', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Update the summary textarea and show the section
                        if (data.summary) {
                            summaryTextarea.value = data.summary;
                            summaryInput.value = data.summary;
                            summarySection.style.display = 'block';
                        } else if (data.error) {
                            alert('Error: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while summarizing the note.');
                    })
                    .finally(() => {
                        // Reset button state
                        summarizeBtn.classList.remove('is-loading');
                        summarizeBtn.disabled = false;
                    });
                });
            }
        });
    </script>
</body>
</html>